CHAMPIONS LEAGUE SCRAPER NAME MATCHING FIX PLAN
==================================================

ISSUE IDENTIFIED:
-----------------
The scraper has issues matching team names for Champions League matches. The confidence 
thresholds used for name matching are too strict for Champions League teams, which may 
have different naming conventions (international teams vs Spanish domestic teams).

ROOT CAUSE ANALYSIS:
--------------------
1. Location: quinipolo-be/services/scraper/teamMatcher.js
   - Function: getConfidenceThresholds(name)
   - Problem: Only considers name length, ignores Champions League context
   - Current thresholds:
     * Length >= 12: confident: 0.92, low: 0.75
     * Length >= 9: confident: 0.88, low: 0.72
     * Length >= 6: confident: 0.83, low: 0.68
     * Otherwise: confident: 0.78, low: 0.6

2. Location: quinipolo-be/services/scraper/scraperService.js
   - Function: fetchAndSelectMatches() -> normalizedMatches mapping
   - Problem: matchTeamNameSync() called without Champions League context
   - Line 87-88: homeTeam/awayTeam matching doesn't pass isChampionsLeague flag

3. Location: quinipolo-be/services/scraper/teamMatcher.js
   - Function: matchTeamNameSync(flashscoreName)
   - Problem: Doesn't accept isChampionsLeague parameter

4. Location: quinipolo-scrapper/src/index.ts (TypeScript version)
   - Function: attachTeamIds() -> findTeamId()
   - Problem: Similar issue - doesn't consider Champions League context
   - Function: getConfidenceThresholds() - same thresholds, no CL adjustment

SOLUTION APPROACH:
------------------
1. Lower confidence thresholds for Champions League matches (more lenient matching)
2. Pass isChampionsLeague flag through the matching pipeline
3. Apply same fix to both JavaScript (backend) and TypeScript (scrapper) versions

IMPLEMENTATION STEPS:
---------------------
[X] Step 1: Update teamMatcher.js - Modify getConfidenceThresholds to accept isChampionsLeague
   - Add isChampionsLeague parameter (default: false)
   - For CL matches, reduce thresholds by ~12-15% to be more lenient
   - CL thresholds: 0.80/0.65 (>=12), 0.76/0.62 (>=9), 0.72/0.58 (>=6), 0.68/0.52 (otherwise)
   - COMPLETED

[X] Step 2: Update teamMatcher.js - Modify matchTeamNameSync to accept isChampionsLeague
   - Add optional isChampionsLeague parameter (default: false)
   - Pass it to getConfidenceThresholds()
   - Added context to warning messages for CL matches
   - COMPLETED

[X] Step 3: Update scraperService.js - Pass isChampionsLeague flag
   - In normalizedMatches mapping, pass match.isChampionsLeague to matchTeamNameSync
   - Update both homeTeam and awayTeam calls
   - COMPLETED

[X] Step 4: Update TypeScript scrapper (quinipolo-scrapper/src/index.ts)
   - Modify getConfidenceThresholds to accept isChampionsLeague
   - Modify findTeamId to accept and pass isChampionsLeague
   - Modify attachTeamIds to detect CL matches via leagueId === "CL"
   - Added context to warning messages for CL matches
   - COMPLETED

[X] Step 5: Test the changes
   - No linter errors found
   - Code changes are backward compatible (default parameters)
   - Ready for testing with actual Champions League matches

CONFIDENCE THRESHOLD ADJUSTMENTS:
----------------------------------
For Champions League matches, reduce thresholds by ~12-15%:

Original -> CL Adjusted:
- Length >= 12: 0.92/0.75 -> 0.80/0.65
- Length >= 9:  0.88/0.72 -> 0.76/0.62
- Length >= 6:  0.83/0.68 -> 0.72/0.58
- Otherwise:    0.78/0.60 -> 0.68/0.52

This makes CL matching ~12-15% more lenient while still maintaining quality.

FILES TO MODIFY:
----------------
1. quinipolo-be/services/scraper/teamMatcher.js
2. quinipolo-be/services/scraper/scraperService.js
3. quinipolo-scrapper/src/index.ts

TESTING CHECKLIST:
------------------
[X] Champions League matches use lower thresholds - IMPLEMENTED
[X] Domestic matches still use original thresholds - IMPLEMENTED (default parameter)
[X] No regressions in existing name matching - Backward compatible
[X] Both homeTeam and awayTeam benefit from CL adjustment - IMPLEMENTED
[X] TypeScript scrapper version also updated - IMPLEMENTED

CHANGES SUMMARY:
----------------
1. quinipolo-be/services/scraper/teamMatcher.js
   - getConfidenceThresholds() now accepts isChampionsLeague parameter
   - matchTeamNameSync() now accepts isChampionsLeague parameter
   - CL matches use ~12-15% lower thresholds for more lenient matching

2. quinipolo-be/services/scraper/scraperService.js
   - Passes match.isChampionsLeague flag to matchTeamNameSync() for both teams

3. quinipolo-scrapper/src/index.ts
   - getConfidenceThresholds() now accepts isChampionsLeague parameter
   - findTeamId() now accepts isChampionsLeague parameter
   - attachTeamIds() detects CL matches via leagueId === "CL"

All changes are backward compatible with default parameters.

